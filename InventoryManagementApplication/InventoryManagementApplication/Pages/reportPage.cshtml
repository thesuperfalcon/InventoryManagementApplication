@page
@model InventoryManagementApplication.Pages.reportPageModel
@{
}

<h1>Lagersaldo</h1>

<div class="mb-3">
    <button id="toggleAll" class="btn btn-primary">Visa alla</button>
</div>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Lagernamn</th>
            <th>Max antal</th>
            <th>Antal</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var storage in Model.Storages)
        {
            var uniqueId = $"nestedTable{storage.Id}";

            <tr class="toggle-row" data-target="#@uniqueId">
                <td>
                    <i class="bi bi-plus-square toggle-icon" data-target="#@uniqueId"></i>
                    @storage.Name
                </td>
                <td>
                    @storage.MaxCapacity
                </td>
                <td>
                    @storage.CurrentStock
                </td>
            </tr>

            <tr id="@uniqueId" class="nested-table-row" style="display: none;">
                <td colspan="3">
                    @if (storage.InventoryTrackers.Any())
                    {
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th>Produktnamn</th>
                                    <th>Antal i lager</th>
                                    <th>Ändrad</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var product in storage.InventoryTrackers)
                                {
                                    <tr>
                                        <td>@product.Product.Name</td>
                                        <td>@product.Quantity</td>
                                        <td>@product.Product.Updated</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                    else
                    {
                        <p class="text-center">Inga produkter finns...</p>
                    }

                </td>
            </tr>
        }
    </tbody>
</table>


@section Scripts {
    <script>
        $(document).ready(function () {
            var isOpen = false; // Variable to track the state

            // Toggle nested table visibility and icon when clicking the storage row
            $(".toggle-icon").click(function () {
                var target = $(this).data("target");
                var $nestedTable = $(target);

                if ($nestedTable.is(":visible")) {
                    // If the nested table is visible, hide it and switch to plus icon
                    $nestedTable.hide();
                    $(this).removeClass("bi-dash-square").addClass("bi-plus-square");
                } else {
                    // If the nested table is hidden, show it and switch to dash icon
                    $nestedTable.show();
                    $(this).removeClass("bi-plus-square").addClass("bi-dash-square");
                }
            });

            // Toggle all nested tables and button text
            $("#toggleAll").click(function () {
                if (isOpen) {
                    // If currently open, close all nested tables and update button text
                    $(".nested-table-row").hide();
                    $(".toggle-icon").removeClass("bi-dash-square").addClass("bi-plus-square");
                    $(this).text("Visa alla");
                } else {
                    // If currently closed, open all nested tables and update button text
                    $(".nested-table-row").show();
                    $(".toggle-icon").removeClass("bi-plus-square").addClass("bi-dash-square");
                    $(this).text("Stäng alla");
                }
                isOpen = !isOpen; // Toggle the state
            });
        });
    </script>
}
