@page "{id:int}"
@model InventoryManagementApplication.Pages.ProductDetailsModel

<div class="product-container">
 <div class="row flex-container">
         <div class="col-md-8 first-column">
            <div class="card mb-8">
              
         <div class="card-header d-flex align-items-center justify-content-between">
                    <h2>Produktdetaljer: @Model.Product.Name</h2>
@* Bara admin kan göra ändringar *@
@if (User.IsInRole("Admin"))
{
<button class="btn btn-generic" data-bs-toggle="modal" data-bs-target="#editProductModal">
    <i class="bi bi-pencil"></i>
</button>
   }
   </div>
                <div class="card-body">

                    @if (Model.Product != null)
                    {
                        <table class="table">
                            <tr>
                                <th><strong>Namn</strong></th>
                                <td>@Model.Product.Name</td>
                            </tr>
                            <tr>
                                <th><strong>Artikelnummer</strong></th>
                                <td>@Model.Product.ArticleNumber</td>
                            </tr>
                            <tr>
                                <th><strong>Beskrivning</strong></th>
                                <td>@Model.Product.Description</td>
                            </tr>
                            <tr>
                                <th><strong>Totalantal</strong></th>
                                <td>@Model.Product.TotalStock</td>
                            </tr>
                            <tr>
                                <th><strong>Tillgängligt antal</strong></th>
                                <td>@Model.Product.CurrentStock</td>
                            </tr>
                            <tr>
                                <th><strong>Produkt skapad</strong></th>
                                <td>@Model.Product.Created</td>
                            </tr>
                            <tr>
                                <th><strong>Information uppdaterad</strong></th>
                                <td>@Model.Product.Updated</td>
                            </tr>
                        </table>


                    }
                    else
                    {
                        <p>Produkt kunde inte laddas.</p>
                    }
                </div>
            </div>
        </div>

      <div class="col-md-8 custom-second-column">
          <div class="card mb-8">
                      <div class="card-header d-flex align-items-center justify-content-between">
                    <h3 class="d-flex align-items-center" >Aktivitetsloggar</h3>
                    </div>
                     <div class="card-body">
                    <input type="text" id="activityLogSearchInput" placeholder="Sök..." class="form-control mb-2" />

                    <table class="table table-striped" id="activityLogTable" data-sort-direction="asc">

                <thead>
    <tr>
        <th onclick="sortActivityLogTable(0)" style="cursor:pointer;">
            Namn
            <i class="bi bi-chevron-expand" id="activityLogSortIcon0"></i>
        </th>
        <th onclick="sortActivityLogTable(1)" style="cursor:pointer;">
            Anställd
            <i class="bi bi-chevron-expand" id="activityLogSortIcon1"></i>
        </th>
        <th onclick="sortActivityLogTable(2)" style="cursor:pointer;">
            Händelse
            <i class="bi bi-chevron-expand" id="activityLogSortIcon2"></i>
        </th>
        <th onclick="sortActivityLogTable(3)" style="cursor:pointer;">
            Datum
            <i class="bi bi-chevron-expand" id="activityLogSortIcon3"></i>
        </th>
    </tr>
</thead>

                        <tbody id="activityLogTableBody">
                            @if (Model.ActivityLogs.Any())
                            {
                                for (int i = 0; i < Model.ActivityLogs.Count; i++)
                                {
                                    var log = Model.ActivityLogs[i];
                                    <tr>
                                        <td>@Model.UserFullName[i]</td>
                                        <td>@Model.UserEmployeeNumbers[i]</td>
                                        <td>@log.Action</td>
                                        <td>@log.TimeStamp</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="4" class="text-center">
                                        Inga aktivitetsloggar är tillgängliga för denna
                                        produkt.
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                <div class="d-flex justify-content-between align-items-center">
    <button id="activityLogPrevPage" class="btn btn-secondary">Föregående</button>
    <span id="activityLogPageNumber"></span>
    <button id="activityLogNextPage" class="btn btn-secondary">Nästa</button>
</div>
        </div>
    </div>
</div>

<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProductModalLabel">Ändra produktinformation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Stäng"></button>
            </div>
                                <div class="modal-body">
                                    <form method="post" asp-page-handler="UpdateProductInfo"
                                          onsubmit="return validateForm();">
                                        <input type="hidden" name="ProductId" value="@Model.Product.Id" />
                                        <div class="form-group mb-3">
                                            <label for="ProductName">Nytt namn</label>
                                            <input type="text" class="form-control" id="ProductName" name="ProductName"
                                                   value="@Model.Product.Name" required />
                                        </div>
                                        <div class="form-group mb-3">
                                            <label for="ProductDescription">Ny beskrivning</label>
                                            <textarea class="form-control" id="ProductDescription"
                                                      name="ProductDescription" required>@Model.Product.Description</textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Spara ändringar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                 @section Scripts {
<script src="~/js/productdetails.js" asp-append-version="true"></script>
  <link rel="stylesheet" href="~/css/detailspages.css" asp-append-version="true" />
}
