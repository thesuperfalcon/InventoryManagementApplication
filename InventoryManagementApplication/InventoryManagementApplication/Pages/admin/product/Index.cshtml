@page
@model InventoryManagementApplication.Pages.admin.product.IndexModel

@{
    ViewData["Title"] = "Produktkatalog";
    string IsDeletedMessage = Model.IsDeletedToggle == false ? "Aktiva" : "Borttagna";

}

<h1>Produktkatalog</h1>
<h3>Antal (@IsDeletedMessage)produkter: @Model.ProductCount</h3>

<div class="button-container">
    <form method="post" asp-route-buttonId="1">
        <input type="hidden" name="IsDeletedToggle" value="@Model.IsDeletedToggle.ToString().ToLower()" />
        <button class="btn btn-primary" type="submit">
            @if (Model.IsDeletedToggle)
            {
                <span>Aktiva Produkter</span>
            }
            else
            {
                <span>Borttagna Produkter</span>
            }
        </button>
    </form>
    @if (User.IsInRole("Admin"))
    {
        <a asp-page="./Create" class="btn btn-primary me-2">Lägg till</a>
    }
</div>

<div class="row mb-3">
    <div class="col-md-6">
        <div class="input-group shadow-sm">
            <input type="text" id="searchInput" class="form-control" placeholder="Filtrera produkter..." />
            <span class="input-group-text bg-primary text-white">
                <i class="bi bi-search"></i>
            </span>
        </div>
    </div>
</div>

<table id="productTable" class="table" data-sort-direction="asc">
    <thead>
        <tr>
            <th><a href="javascript:void(0);" onclick="sortTable(0)">Namn</a></th>
            <th><a href="javascript:void(0);" onclick="sortTable(1)">Artikelnummer</a></th>
            <th><a href="javascript:void(0);" onclick="sortTable(2)">Beskrivning</a></th>
            <th><a href="javascript:void(0);" onclick="sortTable(3)">Pris</a></th>
            <th><a href="javascript:void(0);" onclick="sortTable(4)">Totalt</a></th>
            <th><a href="javascript:void(0);" onclick="sortTable(5)">Antal utan lager</a></th>
            <th><a href="javascript:void(0);" onclick="sortTable(6)">Skapad</a></th>
            <th><a href="javascript:void(0);" onclick="sortTable(7)">Ändrad</a></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Products)
        {
            <tr>
                <td>@(string.IsNullOrWhiteSpace(item.Name) ? "Data finns ej" : item.Name)</td>
                <td>@(string.IsNullOrWhiteSpace(item.ArticleNumber) ? "Data finns ej" : item.ArticleNumber)</td>
                <td>@(string.IsNullOrWhiteSpace(item.Description) ? "Data finns ej" : item.Description)</td>
                <td>@(item.Price.HasValue ? String.Format(new System.Globalization.CultureInfo("sv-SE"), "{0:C}", item.Price) : "Data finns ej")</td>
                <td>
                    @(item.TotalStock.HasValue ? item.TotalStock.ToString() : "Data finns ej")
                    @if (item.IsDeleted == false)
                    {
                        <a asp-page="./SellProduct" asp-route-storageId="0" asp-route-id="@item.Id">Sälj produkt</a>
                    }
                </td>
                <td>@(item.CurrentStock.HasValue ? item.CurrentStock.ToString() : "Data finns ej")</td>
                <td>@(item.Created.HasValue ? item.Created.Value.ToString("yyyy-MM-dd") : "Data finns ej")</td>
                <td>@(item.Updated.HasValue ? item.Updated.Value.ToString("yyyy-MM-dd") : "Data finns ej")</td>
                <td>
                    @if (item.IsDeleted == false)
                    {

                        @if (User.IsInRole("Admin"))
                        {
                            <a asp-page="./Edit" asp-route-id="@item.Id">Ändra</a>
                            <span> | </span>
                            <a asp-page="/ProductDetails" asp-route-id="@item.Id">Info</a>
                            <span> | </span>
                            <a asp-page="./Delete" asp-route-id="@item.Id">Ta bort</a>
                        }
                        else
                        {
                            <a asp-page="./Edit" asp-route-id="@item.Id">Fyll på</a>
                            <span> | <a asp-page="/ProductDetails" asp-route-id="@item.Id">Info</a> | </span>
                        }
                    }
                    else
                    {
                        @if (User.IsInRole("Admin"))
                        {
                            <a asp-page="./Edit" asp-route-id="@item.Id">Återskapa</a>
                            <a asp-page="/ProductDetails" asp-route-id="@item.Id">Info</a>
                            <span> | </span>
                            <a asp-page="./Delete" asp-route-id="@item.Id">Ta bort</a>
                        }
                        else
                        {
                            <a asp-page="/ProductDetails" asp-route-id="@item.Id">Info</a>
                        }
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script src="~/js/productIndex.js"></script>
}
