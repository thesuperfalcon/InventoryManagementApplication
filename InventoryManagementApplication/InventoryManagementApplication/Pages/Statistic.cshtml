@page
@model InventoryManagementApplication.Pages.StatisticModel
@{
    string
    formattedDate = DateTime.Now.ToString("dddd dd/MM yyyy");
    formattedDate = char.ToUpper(formattedDate[0]) + formattedDate.Substring(1);


 }



<h1>Lagersaldo och Förflyttningsstatistik @formattedDate</h1>


<div class="mb-3">
    <button id="toggleButton" class="btn btn-primary">Statistik</button>
</div>

<div id="content1" style="display: none;">
    <h2>Leaderboard</h2>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Användare</th>
                <th>Total förflyttade produkter</th>
                <th>Antal förflyttningar</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var person in Model.MovementPerPerson.OrderByDescending(p => p.TotalQuantity))
            {
                <tr>
                    <td>
                        <span class="toggle-icon" data-target="#recentMovements_@person.EmployeeNumber">
                            <i class="bi bi-plus-square"></i>
                        </span>
                        @person.EmployeeNumber
                    </td>
                    <td>@person.TotalQuantity</td>
                    <td>@person.TotalMovements</td>
                </tr>
                <tr id="recentMovements_@person.EmployeeNumber" class="nested-table-row" style="display:none;">
                    <td colspan="3">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Produkt</th>
                                    <th>Produkter flyttade</th>
                                    <th>Flyttad från</th>
                                    <th>Flyttad till</th>
                                    <th>När</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var movement in person.RecentMovements)
                                {
                                    <tr>
                                        <td>@movement.ProductName</td>
                                        <td>@movement.Quantity</td>
                                        <td>@movement.IntitialStorageName</td>
                                        <td>@movement.DestinationStorageName</td>
                                        <td>@movement.Moved</td>
                                    </tr>
                                }
                                @if (!person.RecentMovements.Any())
                                {
                                    <tr>
                                        <td colspan="6" class="text-center">Ingen data..</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </td>
                </tr>
            }
        </tbody>


    </table>
</div>

<div id="content2" class="mt-3" style="display: block;">
    <h2>Statistik</h2>
    <table id="statisticsTable" class="table" data-sort-direction="asc">
        <thead>
            <tr>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(0)">Namn</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(1)">Anställningsnummer</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(3)">Produkt</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(4)">Produkter flyttade</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(5)">Flyttad från</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(6)">Flyttad till</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(7)">När</a></th>
            </tr>
        </thead>
        <tbody id="myTable">
            @if (Model.Statistics.Any())
            {
                @foreach (var statistic in Model.Statistics)
                {
                    <tr>
                        <td>@statistic.UserName</td>
                        <td>@statistic.EmployeeNumber</td>
                        <td>@statistic.ProductName</td>
                        <td>@statistic.Quantity</td>
                        <td>@statistic.IntitialStorageName</td>
                        <td>@statistic.DestinationStorageName</td>
                        <td>@statistic.Moved</td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="8" class="text-center">Ingen data..</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        const toggleButton = document.getElementById('toggleButton');
        const content1 = document.getElementById('content1');
        const content2 = document.getElementById('content2');

        let isContent1Visible = false;

        toggleButton.addEventListener('click', () => {
            if (isContent1Visible) {
                content1.style.display = 'none';
                content2.style.display = 'block';
                toggleButton.textContent = 'Leaderboard';
            } else {
                content1.style.display = 'block';
                content2.style.display = 'none';
                toggleButton.textContent = 'Statistik';
            }
            isContent1Visible = !isContent1Visible;
        });

        $(document).ready(function () {
            $(".toggle-icon").click(function () {
                var target = $(this).data("target");
                var $nestedTable = $(target);

                if ($nestedTable.is(":visible")) {
                    $nestedTable.hide();
                    $(this).find("i").removeClass("bi-dash-square").addClass("bi-plus-square");
                } else {
                    $nestedTable.show();
                    $(this).find("i").removeClass("bi-plus-square").addClass("bi-dash-square");
                }
            });
        });
    </script>
}
