@page
@model InventoryManagementApplication.Pages.StatisticModel
@{
    string formattedDate = DateTime.Now.ToString("dddd dd/MM yyyy");
    formattedDate = char.ToUpper(formattedDate[0]) + formattedDate.Substring(1);
}

<h1>Lagersaldo och Förflyttningsstatistik @formattedDate</h1>

<div class="mb-3">
    <button id="toggleButton" class="btn btn-primary" onclick="toggleContent()">Visa Statistik</button>
</div>

<button id="helpButton" class="btn btn-info" onclick="toggleHelp()">Hjälp</button>

<div id="helpPopup" class="popup" style="display: none;">
    <div class="popup-content">
        <span class="close" onclick="toggleHelp()">&times;</span>
        <h4 class="alert-heading">Sökfunktion för Lagersaldo och Förflyttningsstatistik</h4>
        <p>Den här sökfunktionen gör det enkelt för användare att hitta specifik information i tabellen. Här är hur den fungerar:</p>
        <ul>
            <li><strong>Inmatning:</strong> Börja med att skriva i sökfältet. Texten omvandlas automatiskt till små bokstäver för att säkerställa att sökningen är oberoende av versaler.</li>
            <li><strong>Filtrering:</strong> Sökningen stödjer flera filter som separeras med kommatecken (<code>,</code>). Varje filter kan antingen vara ett enkelt sökord eller innehålla en nyckel följt av ett kolon (<code>:</code>).</li>
            <li><strong>Allmän sökning:</strong> Om du skriver ett sökord utan kolon, söker systemet i alla kolumner. Exempel: om du skriver <code>produkt</code> letar det efter ordet "produkt" i alla kolumner.</li>
            <li><strong>Specifik sökning:</strong> Använd nycklar för att söka i specifika kolumner:
                <ul>
                    <li><code>#e:123</code> letar efter "123" i Anställningsnummer.</li>
                    <li><code>#p:term</code> letar efter "term" i Produkt-kolumnen.</li>
                </ul>
            </li>
            <li><strong>Exakt matchning:</strong> Om du avslutar en sökterm med en punkt (<code>.</code>), görs en exakt sökning.</li>
            <li><strong>Resultat:</strong> Resultaten uppdateras automatiskt när du skriver. Om du inte hittar några resultat kommer meddelandet "Ingen data.." att visas.</li>
        </ul>
    </div>
</div>

<div id="content1" style="display: none;">
    <h2>Leaderboard</h2>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Användare</th>
                <th>Total förflyttade produkter</th>
                <th>Antal förflyttningar</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var person in Model.MovementPerPerson.OrderByDescending(p => p.TotalQuantity))
            {
                <tr>
                    <td>
                        <span class="toggle-icon" data-target="#recentMovements_@person.EmployeeNumber">
                            <i class="bi bi-plus-square"></i>
                        </span>
                        @person.EmployeeNumber
                    </td>
                    <td>@person.TotalQuantity</td>
                    <td>@person.TotalMovements</td>
                </tr>
                <tr id="recentMovements_@person.EmployeeNumber" class="nested-table-row" style="display:none;">
                    <td colspan="3">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Produkt</th>
                                    <th>Produkter flyttade</th>
                                    <th>Flyttad från</th>
                                    <th>Flyttad till</th>
                                    <th>När</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var movement in person.RecentMovements)
                                {
                                    <tr>
                                        <td>@movement.ProductName</td>
                                        <td>@movement.Quantity</td>
                                        <td>@movement.IntitialStorageName</td>
                                        <td>@movement.DestinationStorageName</td>
                                        <td>@movement.Moved</td>
                                    </tr>
                                }
                                @if (!person.RecentMovements.Any())
                                {
                                    <tr>
                                        <td colspan="6" class="text-center">Ingen data..</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div id="content2" class="mt-3" style="display: block;">
    <h2>Statistik</h2>
    
    <div class="mb-3">
        <div class="input-group">
            <input id="searchInput" type="text" class="form-control" placeholder="Sök..." />
            <span class="input-group-text">
                <i class="bi bi-search"></i>
            </span>
        </div>
    </div>

    <table id="statisticsTable" class="table table-striped table-hover" data-sort-direction="asc">
        <thead>
            <tr>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(0)">Namn</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(1)">Anställningsnummer</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(2)">Produkt</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(3)">Produkter flyttade</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(4)">Flyttad från</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(5)">Flyttad till</a></th>
                <th scope="col"><a href="javascript:void(0);" onclick="sortTable(6)">När</a></th>
            </tr>
        </thead>
        <tbody id="myTable">
            @if (Model.Statistics.Any())
            {
                @foreach (var statistic in Model.Statistics)
                {
                    <tr>
                        <td>@statistic.UserName</td>
                        <td>@statistic.EmployeeNumber</td>
                        <td>@statistic.ProductName</td>
                        <td>@statistic.Quantity</td>
                        <td>@statistic.IntitialStorageName</td>
                        <td>@statistic.DestinationStorageName</td>
                        <td>@statistic.Moved</td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="8" class="text-center">Ingen data..</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="mb-3">
        <button id="prevPage" class="btn btn-primary">Bak</button>
        <span id="pageNumber" class="mx-3"></span>
        <button id="nextPage" class="btn btn-primary">Fram</button>
    </div>
</div>

@section Scripts {
    <script src="~/js/statistic.js"></script>
    <link rel="stylesheet" href="~/css/statistic.css">
}

